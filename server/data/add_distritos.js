const readline = require('readline'),
  fs = require('fs'),
  db = require('../db')
  Distrito = require('../models/almacenes/distrito-model')

const readInterface = readline.createInterface({
  input: fs.createReadStream('./distritos_descentralizados_json.csv')
})
//const jsonString = '{ "type": "Feature", "properties": "", "geometry": { "type": "Polygon", "coordinates": [ [ [ -60.732331, -32.992914 ], [ -60.729594, -32.992851 ], [ -60.723166, -32.992699 ], [ -60.716404, -32.992553 ], [ -60.713506, -32.992484 ], [ -60.710373, -32.992410 ], [ -60.708586, -32.992370 ], [ -60.699840, -32.992165 ], [ -60.689435, -32.991879 ], [ -60.689438, -32.991945 ], [ -60.688822, -32.991931 ], [ -60.688832, -32.992471 ], [ -60.688982, -32.995174 ], [ -60.689038, -32.998252 ], [ -60.687725, -32.998212 ], [ -60.682936, -32.998075 ], [ -60.677657, -32.997920 ], [ -60.674901, -32.997847 ], [ -60.674692, -32.997896 ], [ -60.671985, -32.997808 ], [ -60.664231, -32.997578 ], [ -60.662190, -32.997515 ], [ -60.661996, -32.997508 ], [ -60.658373, -32.997397 ], [ -60.657822, -32.998239 ], [ -60.656876, -32.999660 ], [ -60.654566, -33.003160 ], [ -60.653778, -33.004352 ], [ -60.653166, -33.005131 ], [ -60.653067, -33.005251 ], [ -60.652572, -33.005993 ], [ -60.651953, -33.006943 ], [ -60.651322, -33.007909 ], [ -60.651215, -33.008053 ], [ -60.650593, -33.008884 ], [ -60.657170, -33.009105 ], [ -60.664690, -33.009345 ], [ -60.664519, -33.014346 ], [ -60.663791, -33.026236 ], [ -60.665390, -33.026309 ], [ -60.669368, -33.026288 ], [ -60.671116, -33.027378 ], [ -60.671826, -33.027357 ], [ -60.672857, -33.027799 ], [ -60.673568, -33.027804 ], [ -60.674601, -33.028479 ], [ -60.674887, -33.028513 ], [ -60.675162, -33.028458 ], [ -60.675937, -33.028624 ], [ -60.677048, -33.028376 ], [ -60.677869, -33.027746 ], [ -60.678164, -33.027637 ], [ -60.678377, -33.027743 ], [ -60.678326, -33.028012 ], [ -60.678212, -33.028288 ], [ -60.678299, -33.028637 ], [ -60.678480, -33.028762 ], [ -60.679557, -33.028523 ], [ -60.680078, -33.028664 ], [ -60.680906, -33.029230 ], [ -60.681831, -33.029601 ], [ -60.682715, -33.029514 ], [ -60.683617, -33.029850 ], [ -60.683784, -33.030103 ], [ -60.683920, -33.030329 ], [ -60.684026, -33.030634 ], [ -60.683997, -33.030905 ], [ -60.685108, -33.031615 ], [ -60.685583, -33.031844 ], [ -60.685483, -33.032246 ], [ -60.685941, -33.032602 ], [ -60.686374, -33.032503 ], [ -60.687125, -33.033355 ], [ -60.688066, -33.033367 ], [ -60.688113, -33.034145 ], [ -60.689845, -33.034808 ], [ -60.690390, -33.034794 ], [ -60.694624, -33.037370 ], [ -60.698189, -33.039345 ], [ -60.698553, -33.038859 ], [ -60.698808, -33.038515 ], [ -60.701640, -33.034713 ], [ -60.701849, -33.034419 ], [ -60.703074, -33.032664 ], [ -60.703977, -33.031361 ], [ -60.705961, -33.028501 ], [ -60.707279, -33.026601 ], [ -60.707393, -33.026604 ], [ -60.708119, -33.025827 ], [ -60.708946, -33.024910 ], [ -60.709996, -33.024552 ], [ -60.710803, -33.024269 ], [ -60.711122, -33.023904 ], [ -60.712880, -33.021954 ], [ -60.712899, -33.021874 ], [ -60.713389, -33.021324 ], [ -60.715494, -33.018909 ], [ -60.715685, -33.018625 ], [ -60.715942, -33.018089 ], [ -60.716617, -33.016671 ], [ -60.717103, -33.015647 ], [ -60.717172, -33.015642 ], [ -60.717541, -33.014855 ], [ -60.718144, -33.013608 ], [ -60.718896, -33.012014 ], [ -60.719444, -33.010872 ], [ -60.719649, -33.010461 ], [ -60.721024, -33.007622 ], [ -60.726772, -33.007768 ], [ -60.727180, -33.006692 ], [ -60.728913, -33.002181 ], [ -60.729867, -32.999687 ], [ -60.730773, -32.997204 ], [ -60.731865, -32.994255 ], [ -60.732331, -32.992914 ] ] ] } }'
//console.log(JSON.parse(jsonString))
readInterface.on('line', (line) => {
  let jsonString = line.substr(line.indexOf('"{')).trim()
  jsonString = jsonString.replace('"{','{').replace('}"','}').replace(/\"\"/g,'"')
  const geojson = JSON.parse(jsonString.replace(/\r\n/g,'')).geometry
  const parser = line.split(',')
  let aux = {
    distrito: parser[0],
    observacion: parser[1],
    geojson: geojson
  }
  Distrito.create(aux)
})

/*readInterface.on('close', function(line) {
  console.log('Archivo importado')
  process.exit(0)
 });*/